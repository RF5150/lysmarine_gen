# Allow mopidy user to access X server
xhost +SI:localuser:mopidy

export MOZ_USE_XINPUT2=1

if [ -L /dev/twofingtouch -a ! -f /usr/share/X11/xorg.conf.d/90-touchinput.conf ]; then
  MATCH_PRODUCT=$(udevadm info -a -n /dev/twofingtouch | grep "ATTRS{name}" | sed -e 's#.*=="##' -e 's#"$##')
  bash -c 'cat << EOF > /usr/share/X11/xorg.conf.d/90-touchinput.conf
Section "InputClass"
    Identifier "calibration"
    Driver "evdev"
    MatchProduct "'"${MATCH_PRODUCT}"'"
    MatchDevicePath "/dev/input/event*"
    Option "EmulateThirdButton" "1"
    Option "EmulateThirdButtonTimeout" "750"
    Option "EmulateThirdButtonMoveThreshold" "30"
EndSection
EOF'
fi

# Setting sound
amixer cset numid=3 1
amixer sset -D pulse Master 98% unmute
amixer sset Master 98% unmute
amixer -c 1 cset numid=1 98%

(rm -rf ~/.config/*nativefier*/Cache/ || true) &
(cp .config/signalk-nativefier-*/Cookies .config/sk-autopilot-nativefier-*/ || true) &

xset s off &
xset -dpms &
xset s noblank &

evdev-rce &
(twofing --click=first --grab-by-disabling /dev/twofingtouch || true) &

/usr/local/bin/bbn-launcherd &
(sleep 4 && /opt/bbn-launcher/bbn-launcher) &

(sleep 7 && nm-applet) &
(sleep 8 && onboard) &
(sleep 30 && autoadb scrcpy -s '{}') &
(sleep 60 && sh -c 'while ! ping -c 1 -n -w 1 spotify.com; do sleep 20; done;' && \
  systemctl --user reenable raspotify && systemctl --user start raspotify) &
